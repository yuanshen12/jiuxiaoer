import time
import unittest

from automation.mobile.mobdriver import MobDriver, collect_prerequisites
from automation.mobile.uicomponents import UIComponents
from desired_capabilities import get_desired_capabilities

# collect platform and app installation bundle details
dict = collect_prerequisites()


class {0}(unittest.TestCase):
    @classmethod
    def setUpClass(cls):
        desired_caps = get_desired_capabilities(app_path=dict['app_bundle'], platform=dict['platform'])
        cls.driver = MobDriver('http://localhost:4723/wd/hub', desired_caps)

    @classmethod
    def tearDownClass(cls):
        cls.driver.quit()

    #
    # THESE ARE JUST SAMPLE TEST CASES FOR YOUR REFERENCE.
    # WRITE YOUR OWN TEST CASES HERE, AND DELETE OR COMMENT EXISTING TO AVOID EXCEPTIONS.
    # SOME GOOD PRACTICES
    # - KEEP YOUR COMMON DATA VARS GLOBAL AND REUSE THEM
    # - EACH TEST CASE METHOD NAME SHOULD START WITH test_# TO MAINTAIN ITS SEQUENCE
    # - USE time.sleep(seconds) ACCORRDING TO SPEED OF YOUR MACHINE
    #

    display_name = 'Test User'
    user_name = 'test.user'
    password = 'test1234'

    invalid_user = 'invalid'
    invalid_pass = 'invalid'

    def test_1_login_invalid_username(cls):
        btn_login = cls.driver.find_by_name(UIComponents.BUTTON, 'Login')
        btn_login.click()

        result = cls.driver.check_alert(msg='Please enter username')
        cls.assertTrue(result.result, result.msg)

    def test_2_login_invalid_password(cls):
        txt_user = cls.driver.find_by_name(UIComponents.TEXTFIELD, 'Username')
        txt_user.set_value(cls.invalid_user)
        cls.driver.hide_keyboard()

        btn_login = cls.driver.find_by_name(UIComponents.BUTTON, 'Login')
        btn_login.click()

        result = cls.driver.check_alert(msg='Please enter password')
        cls.assertTrue(result.result, result.msg)

    def test_3_login_invalid_credentials(cls):
        txt_pwd = cls.driver.find_by_name(UIComponents.PWDFIELD, 'Password')
        txt_pwd.set_value(cls.invalid_pass)
        cls.driver.hide_keyboard()

        btn_login = cls.driver.find_by_name(UIComponents.BUTTON, 'Login')
        btn_login.click()

        result = cls.driver.check_alert(msg='Invalid username or password')
        cls.assertTrue(result.result, result.msg)

    def test_4_register_invalid_displayname(cls):
        btn_reg = cls.driver.find_by_name(UIComponents.BUTTON, 'Register')
        btn_reg.click()

        time.sleep(5)

        btn_reg = cls.driver.find_by_name(UIComponents.BUTTON, 'Register')
        btn_reg.click()

        result = cls.driver.check_alert(msg='Please enter display name')
        cls.assertTrue(result.result, result.msg)

    def test_5_register_invalid_username(cls):
        txt_dn = cls.driver.find_by_name(UIComponents.TEXTFIELD, 'Display name')
        txt_dn.set_value(cls.display_name)
        cls.driver.hide_keyboard()

        btn_reg = cls.driver.find_by_name(UIComponents.BUTTON, 'Register')
        btn_reg.click()

        result = cls.driver.check_alert(msg='Please enter username')
        cls.assertTrue(result.result, result.msg)

    def test_6_register_invalid_password(cls):
        txt_user = cls.driver.find_by_name(UIComponents.TEXTFIELD, 'Username')
        txt_user.set_value(cls.user_name)
        cls.driver.hide_keyboard()

        btn_reg = cls.driver.find_by_name(UIComponents.BUTTON, 'Register')
        btn_reg.click()

        result = cls.driver.check_alert(msg='Please enter password')
        cls.assertTrue(result.result, result.msg)

    def test_7_register_valid_registration(cls):
        txt_pwd = cls.driver.find_by_name(UIComponents.PWDFIELD, 'Password')
        txt_pwd.set_value(cls.user_name)
        cls.driver.hide_keyboard()

        btn_reg = cls.driver.find_by_name(UIComponents.BUTTON, 'Register')
        btn_reg.click()

        result = cls.driver.check_alert(msg='Registered successfully')
        cls.assertTrue(result.result, result.msg)

    def test_8_login_valid_login(cls):
        time.sleep(5)

        txt_pwd = cls.driver.find_by_name(UIComponents.TEXTFIELD, 'Username')
        txt_pwd.set_value(cls.user_name)
        cls.driver.hide_keyboard()

        txt_pwd = cls.driver.find_by_name(UIComponents.PWDFIELD, 'Password')
        txt_pwd.set_value(cls.user_name)
        cls.driver.hide_keyboard()

        btn_login = cls.driver.find_by_name(UIComponents.BUTTON, 'Login')
        btn_login.click()

        result = cls.driver.check_alert()
        cls.assertFalse(result.result, result.msg)

    def test_9_home_valid_welcome_msg(cls):
        time.sleep(5)

        welcome_msg = 'Welcome ' + cls.display_name + '!'
        txt_welcome = cls.driver.find_by_name(UIComponents.LABEL, welcome_msg)
        if txt_welcome is None:
            cls.assertTrue(False, 'Label not found with msg - ' + welcome_msg)


if __name__ == "__main__":
    suite = unittest.TestLoader().loadTestsFromTestCase({0})
    log_file = '{0}_report.txt'
    f = open(log_file, "w")
    unittest.TextTestRunner(stream=f, verbosity=2).run(suite)
